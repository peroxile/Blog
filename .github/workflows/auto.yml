name: Rebuild Blog

on:
  push:
    branches:
      - main
  workflow_dispatch:
    
jobs:
  build:
      runs-on: ubuntu-latest

      steps:
        - uses: actions/checkout@v4
          with:
            fetch-depth: 0

        - uses:  actions/setup-node@v4
          with:
            node-version: '24'

        - name:   Generate articles manifest
          run: node scripts/build.js

        - name: Commit generated manifest
          run: | 
            git config user.name "GitHub Actions"
            git config user.email "actions@github.com"
            git add public/data/manifest.json
            git diff --quiet && git diff --staged --quiet || (git commit -m "Generate manifest [skip ci]" && git push origin main)